@inject IJSRuntime JS
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>COMACON</title>
        @*Stylesheets*@
        <link rel="stylesheet" href="~/css/style_webserver.css">
        <partial name="~/Views/PartialViews/Scripts/Scripts.cshtml" />
    </head>
    <body id="myBody">
        <template id="DiagnosticsSettingsRouteProfiles">
            <div class="setting-element">
                <input type="checkbox" name="" id="input" class="Profiles" onclick="">
                <label for="label"></label>
            </div>
        </template>
        <!-- Choose Web Application Modal Window -->
        <partial name="~/Views/PartialViews/WebApplications/General/ChooseWebApplicationModal/ChooseWebApplicationModal.cshtml" />
        <!-- Copy Web Application Modal -->
        <partial name="~/Views/PartialViews/WebApplications/General/CopyWebApplicationModal/CopyWebApplicationModal.cshtml" />
        <!-- Successful save Modal -->
        <partial name="~/Views/PartialViews/WebApplications/General/SuccessfulSaveModal/SuccessfulSaveModal.cshtml" />
        <!-- Error Load Modal -->
        <partial name="~/Views/PartialViews/WebApplications/General/ErrorLoadModal/ErrorLoadModal.cshtml" />
        <!-- Connection String Test Modal -->
        <partial name="~/Views/PartialViews/WebApplications/General/ConnectionStringTestModal/ConnectionStringTestModal.cshtml" />
        <!-- Copy Complete Modal Window -->
        <partial name="~/Views/PartialViews/WebApplications/General/CopyCompleteModalWindow/CopyCompleteModalWindow.cshtml" />
        <!-- Loader Modal Window -->
        <div class="loader"></div>
        <!-- Processing Web Config Values Modal -->
        <partial name="~/Views/PartialViews/WebApplications/General/ProcessingWebConfigValuesModal/ProcessingWebConfigValuesModal.cshtml" />
        <!-- Configuration Errors Modal Window -->
        <partial name="~/Views/PartialViews/WebApplications/General/ConfigurationErrorsModal/ConfigurationErrorsModal.cshtml" />
        <!-- Unknown configuration keys modal -->
        <partial name="~/Views/PartialViews/WebApplications/General/UnknownConfigurationKeysModal/UnknownConfigurationKeysModal.cshtml" />
        <!-- New Application Configuration Modal -->
        <partial name="~/Views/PartialViews/WebApplications/General/NewApplicationConfigurationModal/NewApplicationConfigurationModal.cshtml" />
        <header>
            <div id="h1-container" class="h1-container dark_mode_titlebar">
                <div style="display:flex;justify-content:space-between;padding-left: 0.5%;">
                <a style="color:inherit;text-decoration: none;" href="/core/home"><h1 b-8gj57b4bak="">COMACON</h1></a>
                    <div style="margin: 0.5% 10px;display:flex;flex-direction:column;justify-content:center;align-items:center;">
                        <input type="checkbox" class="checkbox" id="checkbox" onclick="toggleDarkLightMode(this)" style="top: -100px;">
                        <label for="checkbox" class="checkbox-label">
                            <i class="fas fa-moon">
                                <svg width="18" height="18" fill="none" stroke="#f39c12" stroke-linecap="round" stroke-linejoin="round" stroke-width="3.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79Z"></path>
                                </svg>
                            </i>
                            <i class="fas fa-sun">
                                <svg width="18" height="18" fill="none" stroke="#f39c12" stroke-linecap="round" stroke-linejoin="round" stroke-width="3.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 7a5 5 0 1 0 0 10 5 5 0 1 0 0-10z"></path>
                                    <path d="M12 1v2"></path>
                                    <path d="M12 21v2"></path>
                                    <path d="m4.22 4.22 1.42 1.42"></path>
                                    <path d="m18.36 18.36 1.42 1.42"></path>
                                    <path d="M1 12h2"></path>
                                    <path d="M21 12h2"></path>
                                    <path d="m4.22 19.78 1.42-1.42"></path>
                                    <path d="m18.36 5.64 1.42-1.42"></path>
                                </svg>
                            </i>
                            <span class="ball"></span>
                        </label>
                        @RenderSection("SettingsButton", false)
                        @* <a id="SettingsButton" style="color:inherit;text-decoration:none;margin-top:5px;" href="/Core/Settings">
                            <svg width="30" height="30" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14 3.269C14 2.568 13.432 2 12.731 2H11.27C10.568 2 10 2.568 10 3.269v0c0 .578-.396 1.074-.935 1.286-.085.034-.17.07-.253.106-.531.23-1.162.16-1.572-.249v0a1.269 1.269 0 0 0-1.794 0L4.412 5.446a1.269 1.269 0 0 0 0 1.794v0c.41.41.48 1.04.248 1.572a7.946 7.946 0 0 0-.105.253c-.212.539-.708.935-1.286.935v0C2.568 10 2 10.568 2 11.269v1.462C2 13.432 2.568 14 3.269 14v0c.578 0 1.074.396 1.286.935.034.085.07.17.105.253.231.531.161 1.162-.248 1.572v0a1.269 1.269 0 0 0 0 1.794l1.034 1.034a1.269 1.269 0 0 0 1.794 0v0c.41-.41 1.04-.48 1.572-.249.083.037.168.072.253.106.539.212.935.708.935 1.286v0c0 .701.568 1.269 1.269 1.269h1.462c.701 0 1.269-.568 1.269-1.269v0c0-.578.396-1.074.935-1.287.085-.033.17-.068.253-.104.531-.232 1.162-.161 1.571.248v0a1.269 1.269 0 0 0 1.795 0l1.034-1.034a1.269 1.269 0 0 0 0-1.794v0c-.41-.41-.48-1.04-.249-1.572.037-.083.072-.168.106-.253.212-.539.708-.935 1.286-.935v0c.701 0 1.269-.568 1.269-1.269V11.27c0-.701-.568-1.269-1.269-1.269v0c-.578 0-1.074-.396-1.287-.935a7.755 7.755 0 0 0-.105-.253c-.23-.531-.16-1.162.249-1.572v0a1.269 1.269 0 0 0 0-1.794l-1.034-1.034a1.269 1.269 0 0 0-1.794 0v0c-.41.41-1.04.48-1.572.249a7.913 7.913 0 0 0-.253-.106C14.396 4.343 14 3.847 14 3.27v0z"></path>
                                <path d="M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0z"></path>
                            </svg>
                        </a> *@
                        @RenderSection("LogoutButton", false)
                    </div>
                </div>
                @RenderSection("LoadedWebApplicationFields", false)
                @RenderSection("CoreActionButtons", false)
            </div>
        </header>
        <!-- Main Container -->
        <div class="">
            <main role="main" class="pb-3">
                @RenderSection("core", required: false)
                <section class="body-core-section">
                    <section id="CoreSectionsButtons" class="CoreSectionsButtons">
                        <div style="display: flex; flex-direction: row;margin: 5px 0;overflow-y: auto;width: max-content;">
                            <div style="max-height: 100vh;max-width:33vh">
                                @RenderSection("CoreButtons", required: false)
                                @* @RenderSection("IisLinks", required: false) *@
                            </div>
                            @RenderSection("AuthenticationOptimizationOptions", required: false)
                        </div>
                    </section>
                    <div style="width: 100%;">
                        <h2 id="SectionTitle"></h2>
                        @RenderBody()
                        <partial name="~/Views/PartialViews/WebApplications/General/IISApplicationConfiguration/IISApplicationConfiguration.cshtml" />
                        <partial name="~/Views/PartialViews/WebApplications/General/DiagnosticsSettings/DiagnosticsSettings.cshtml" />
                    </div>
                </section>
            </main>
        </div>
        <script>
            // console.log(sessionStorage.getItem('comaconbearertoken'));
            if (sessionStorage.getItem("comaconbearertoken") != null && sessionStorage.getItem('comaconbearertoken') != undefined) {
                var token = sessionStorage.getItem('comaconbearertoken');
                // console.log("Verifying token is still valid.");
                fetch(apiRootUrl + '/api/Endpoint/VerifyTokenV2', {
                    method: 'GET', // or 'POST', 'PUT', 'DELETE', etc.
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                        // Add other headers if needed
                    },
                    // body: JSON.stringify(data) // If sending data with POST/PUT request
                })
                .then(response => {
                    setTimeout(() => {
                        if(response.ok && currentPage == "Login"){
                            // console.log("Redirecting to Home page.");
                            window.location.href = "/core/home";
                            // return response.json()
                        // }else if((response.status === 401 || response.status === 400) & currentPage != "Login"){
                        } else if (response.redirected) {
                            window.location.href = response.url;
                        }
                        // else{
                        //     if (currentPage != "Login") {
                        //         window.location.href = "/core/login";
                        //     }else if(currentPage == "Login"){
                        //         window.location.href = "/core/home";
                        //     }
                        // }
                    }, 50);
                })
                // .then(data => {
                //     console.log(data);
                //     if (data == false && currentPage != "Login") {
                //         window.location.href = "/core/login";
                //     }else if(currentPage == "Login" && data == true){
                //         window.location.href = "/core/home";
                //     }
                // })
                .catch(error => console.error('Error:', error));
            } else if (currentPage != "Login") {
                window.location.href = "/core/login";
            }

            window.onload = function () {
                onPageLoadLogic();
                // console.log(sessionStorage.getItem('comaconbearertoken'));
            };
        </script>
    </body>
</html>
